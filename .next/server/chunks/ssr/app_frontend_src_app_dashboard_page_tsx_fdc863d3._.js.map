{"version":3,"sources":["../../../../app/frontend/src/app/dashboard/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { motion } from \"framer-motion\";\nimport { usePrivy } from \"@privy-io/react-auth\";\nimport { useActiveWallet } from \"@/hooks/useActiveWallet\";\nimport Link from \"next/link\";\nimport {\n  Wallet,\n  TrendingUp,\n  DollarSign,\n  ArrowUpRight,\n  Copy,\n  Check,\n  ExternalLink,\n  Receipt,\n  Zap,\n  Globe,\n  Shield,\n  Clock,\n  ChevronRight,\n  Webhook,\n  RefreshCw,\n  Download,\n  Key,\n  LogIn,\n  Home,\n} from \"lucide-react\";\nimport { Navbar } from \"@/components/ui/Navbar\";\nimport { Footer } from \"@/components/ui/Footer\";\n\ninterface PaymentRecord {\n  id: string;\n  sessionId: string;\n  merchantId: string;\n  merchantName: string;\n  customerWallet: string;\n  amount: number;\n  currency: string;\n  description?: string;\n  txSignature: string;\n  status: string;\n  completedAt: number;\n}\n\nexport default function DashboardPage() {\n  const { ready, authenticated, login } = usePrivy();\n  const { publicKey, connected } = useActiveWallet();\n\n  const [payments, setPayments] = useState<PaymentRecord[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [copied, setCopied] = useState<string | null>(null);\n  const [stats, setStats] = useState({\n    totalVolume: 0,\n    totalTransactions: 0,\n    avgTransaction: 0,\n    todayVolume: 0,\n  });\n\n  // Fetch payments for this merchant\n  useEffect(() => {\n    async function fetchPayments() {\n      if (!publicKey) {\n        setLoading(false);\n        return;\n      }\n\n      try {\n        // Filter by merchant wallet\n        const res = await fetch(`/api/payments?wallet=${publicKey}`);\n        if (res.ok) {\n          const data = await res.json();\n          setPayments(data.payments || []);\n\n          // Calculate stats\n          const total =\n            data.payments?.reduce(\n              (sum: number, p: PaymentRecord) => sum + p.amount,\n              0\n            ) || 0;\n          const count = data.payments?.length || 0;\n          const today = new Date().toDateString();\n          const todayPayments =\n            data.payments?.filter(\n              (p: PaymentRecord) =>\n                new Date(p.completedAt).toDateString() === today\n            ) || [];\n          const todayTotal = todayPayments.reduce(\n            (sum: number, p: PaymentRecord) => sum + p.amount,\n            0\n          );\n\n          setStats({\n            totalVolume: total,\n            totalTransactions: count,\n            avgTransaction: count > 0 ? total / count : 0,\n            todayVolume: todayTotal,\n          });\n        }\n      } catch (err) {\n        console.error(\"Failed to fetch payments:\", err);\n      } finally {\n        setLoading(false);\n      }\n    }\n\n    fetchPayments();\n    // Poll every 10 seconds for real-time updates\n    const interval = setInterval(fetchPayments, 10000);\n    return () => clearInterval(interval);\n  }, [publicKey]);\n\n  const copyToClipboard = (text: string, id: string) => {\n    navigator.clipboard.writeText(text);\n    setCopied(id);\n    setTimeout(() => setCopied(null), 2000);\n  };\n\n  const formatAddress = (addr: string) => {\n    return `${addr.slice(0, 4)}...${addr.slice(-4)}`;\n  };\n\n  const formatDate = (timestamp: number) => {\n    return new Date(timestamp).toLocaleDateString(\"en-US\", {\n      month: \"short\",\n      day: \"numeric\",\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n    });\n  };\n\n  return (\n    <>\n      {/* Unified Navbar */}\n      <Navbar />\n\n      <div className=\"min-h-screen bg-[#0a0a0f] text-white p-8 pt-32\">\n        <div className=\"max-w-7xl mx-auto\">\n          {/* Header with Visa News Banner */}\n          <motion.div\n            initial={{ opacity: 0, y: -20 }}\n            animate={{ opacity: 1, y: 0 }}\n            className=\"mb-8\"\n          >\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h1 className=\"text-4xl font-bold mb-2\">Merchant Dashboard</h1>\n                <p className=\"text-zinc-400\">\n                  {connected\n                    ? `Connected: ${formatAddress(publicKey!)}`\n                    : \"Sign in to view your payments\"}\n                </p>\n              </div>\n              <div className=\"flex gap-3\">\n                <Link href=\"/create\">\n                  <motion.button\n                    whileHover={{ scale: 1.02 }}\n                    whileTap={{ scale: 0.98 }}\n                    className=\"px-6 py-3 bg-gradient-to-r from-[#a855f7] to-[#22d3ee] text-white font-semibold rounded-xl flex items-center gap-2\"\n                  >\n                    <Zap className=\"w-4 h-4\" />\n                    Create Payment\n                  </motion.button>\n                </Link>\n                <Link href=\"/offramp\">\n                  <motion.button\n                    whileHover={{ scale: 1.02 }}\n                    whileTap={{ scale: 0.98 }}\n                    className=\"px-6 py-3 bg-white/10 text-white font-semibold rounded-xl flex items-center gap-2 border border-white/20 hover:bg-white/20 transition-all\"\n                  >\n                    <DollarSign className=\"w-4 h-4\" />\n                    Cash Out\n                  </motion.button>\n                </Link>\n              </div>\n            </div>\n          </motion.div>\n\n          {/* Stats Cards */}\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8\">\n            {[\n              {\n                label: \"Total Volume\",\n                value: `$${stats.totalVolume.toLocaleString(undefined, {\n                  minimumFractionDigits: 2,\n                  maximumFractionDigits: 2,\n                })}`,\n                icon: DollarSign,\n                color: \"from-purple-500 to-purple-600\",\n                change: \"+12.5%\",\n              },\n              {\n                label: \"Transactions\",\n                value: stats.totalTransactions.toString(),\n                icon: Receipt,\n                color: \"from-blue-500 to-blue-600\",\n                change: \"+8\",\n              },\n              {\n                label: \"Avg. Transaction\",\n                value: `$${stats.avgTransaction.toFixed(2)}`,\n                icon: TrendingUp,\n                color: \"from-purple-500 to-purple-600\",\n                change: \"+5.2%\",\n              },\n              {\n                label: \"Today\",\n                value: `$${stats.todayVolume.toFixed(2)}`,\n                icon: Clock,\n                color: \"from-amber-500 to-amber-600\",\n                change: \"Live\",\n              },\n            ].map((stat, i) => (\n              <motion.div\n                key={stat.label}\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: i * 0.1 }}\n                className=\"pop-card p-6\"\n              >\n                <div className=\"flex items-start justify-between mb-4\">\n                  <div\n                    className={`p-3 rounded-xl bg-gradient-to-br ${stat.color}`}\n                  >\n                    <stat.icon className=\"w-5 h-5 text-white\" />\n                  </div>\n                  <span className=\"text-cyan-400 text-sm font-medium flex items-center gap-1\">\n                    <ArrowUpRight className=\"w-3 h-3\" />\n                    {stat.change}\n                  </span>\n                </div>\n                <p className=\"text-zinc-400 text-sm mb-1\">{stat.label}</p>\n                <p className=\"text-2xl font-bold\">{stat.value}</p>\n              </motion.div>\n            ))}\n          </div>\n\n          {/* Quick Actions */}\n          <div className=\"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8\">\n            {[\n              {\n                title: \"Payment Links\",\n                description: \"Create & share links\",\n                icon: Globe,\n                href: \"/create\",\n                color:\n                  \"bg-blue-500/10 border-blue-500/30 hover:border-blue-500/50\",\n              },\n              {\n                title: \"Subscriptions\",\n                description: \"Recurring payments\",\n                icon: RefreshCw,\n                href: \"/dashboard/subscriptions\",\n                color:\n                  \"bg-purple-500/10 border-purple-500/30 hover:border-purple-500/50\",\n              },\n              {\n                title: \"Webhooks\",\n                description: \"Payment notifications\",\n                icon: Webhook,\n                href: \"/dashboard/webhooks\",\n                color:\n                  \"bg-orange-500/10 border-orange-500/30 hover:border-orange-500/50\",\n              },\n              {\n                title: \"API Keys\",\n                description: \"Manage SDK access\",\n                icon: Key,\n                href: \"/dashboard/api-keys\",\n                color:\n                  \"bg-purple-500/10 border-purple-500/30 hover:border-purple-500/50\",\n              },\n              {\n                title: \"Compliance\",\n                description: \"KYC/AML settings\",\n                icon: Shield,\n                href: \"/dashboard/compliance\",\n                color:\n                  \"bg-green-500/10 border-green-500/30 hover:border-green-500/50\",\n              },\n              {\n                title: \"Export CSV\",\n                description: \"Download for accounting\",\n                icon: Download,\n                href: publicKey ? `/api/merchants/${publicKey}/export` : \"#\",\n                color:\n                  \"bg-emerald-500/10 border-emerald-500/30 hover:border-emerald-500/50\",\n                download: true,\n              },\n              {\n                title: \"Gasless Payments\",\n                description: \"Zero gas for customers\",\n                icon: Zap,\n                href: \"/demo\",\n                color:\n                  \"bg-amber-500/10 border-amber-500/30 hover:border-amber-500/50\",\n              },\n              {\n                title: \"SDK Docs\",\n                description: \"npm install @settlr/sdk\",\n                icon: Globe,\n                href: \"https://github.com/ABFX15/x402-hack-payment\",\n                color:\n                  \"bg-purple-500/10 border-purple-500/30 hover:border-purple-500/50\",\n              },\n            ].map((action, i) => {\n              const content = (\n                <motion.div\n                  initial={{ opacity: 0, y: 20 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  transition={{ delay: 0.4 + i * 0.1 }}\n                  whileHover={{ scale: 1.02, y: -2 }}\n                  className={`p-6 rounded-2xl border ${action.color} transition-all cursor-pointer group`}\n                >\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-4\">\n                      <action.icon className=\"w-8 h-8 text-white\" />\n                      <div>\n                        <h3 className=\"font-semibold text-lg\">\n                          {action.title}\n                        </h3>\n                        <p className=\"text-zinc-400 text-sm\">\n                          {action.description}\n                        </p>\n                      </div>\n                    </div>\n                    <ChevronRight className=\"w-5 h-5 text-zinc-500 group-hover:text-white transition-colors\" />\n                  </div>\n                </motion.div>\n              );\n\n              // Use anchor tag for downloads, Link for navigation\n              if (\"download\" in action && action.download) {\n                return (\n                  <a key={action.title} href={action.href} download>\n                    {content}\n                  </a>\n                );\n              }\n\n              return (\n                <Link key={action.title} href={action.href}>\n                  {content}\n                </Link>\n              );\n            })}\n          </div>\n\n          {/* Recent Payments Table */}\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ delay: 0.6 }}\n            className=\"pop-card p-6\"\n          >\n            <div className=\"flex items-center justify-between mb-6\">\n              <h2 className=\"text-xl font-bold\">Recent Payments</h2>\n              <span className=\"text-zinc-400 text-sm\">\n                Last 10 transactions\n              </span>\n            </div>\n\n            {loading ? (\n              <div className=\"flex items-center justify-center py-12\">\n                <div className=\"w-8 h-8 border-2 border-white/20 border-t-white rounded-full animate-spin\" />\n              </div>\n            ) : !connected ? (\n              <div className=\"text-center py-12\">\n                <Wallet className=\"w-12 h-12 text-zinc-600 mx-auto mb-4\" />\n                <p className=\"text-zinc-400 mb-4\">\n                  Sign in to view your payments\n                </p>\n                <button\n                  onClick={login}\n                  className=\"px-6 py-3 bg-gradient-to-r from-[#a855f7] to-[#22d3ee] text-white font-semibold rounded-xl flex items-center gap-2 mx-auto\"\n                >\n                  <LogIn className=\"w-4 h-4\" />\n                  Sign In\n                </button>\n              </div>\n            ) : payments.length === 0 ? (\n              <div className=\"text-center py-12\">\n                <Receipt className=\"w-12 h-12 text-zinc-600 mx-auto mb-4\" />\n                <p className=\"text-zinc-400 mb-4\">No payments yet</p>\n                <Link href=\"/create\">\n                  <button className=\"px-6 py-2 bg-white text-black rounded-lg font-medium\">\n                    Create your first payment\n                  </button>\n                </Link>\n              </div>\n            ) : (\n              <div className=\"overflow-x-auto\">\n                <table className=\"w-full\">\n                  <thead>\n                    <tr className=\"text-left text-zinc-500 text-sm border-b border-zinc-800\">\n                      <th className=\"pb-4 font-medium\">Payment ID</th>\n                      <th className=\"pb-4 font-medium\">Customer</th>\n                      <th className=\"pb-4 font-medium\">Amount</th>\n                      <th className=\"pb-4 font-medium\">Status</th>\n                      <th className=\"pb-4 font-medium\">Date</th>\n                      <th className=\"pb-4 font-medium\">Actions</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {payments.slice(0, 10).map((payment, i) => (\n                      <motion.tr\n                        key={payment.id}\n                        initial={{ opacity: 0 }}\n                        animate={{ opacity: 1 }}\n                        transition={{ delay: i * 0.05 }}\n                        className=\"border-b border-zinc-800/50 hover:bg-zinc-900/50 transition-colors\"\n                      >\n                        <td className=\"py-4\">\n                          <div className=\"flex items-center gap-2\">\n                            <code className=\"text-sm font-mono text-zinc-300\">\n                              {payment.id.slice(0, 12)}...\n                            </code>\n                            <button\n                              onClick={() =>\n                                copyToClipboard(payment.id, `id-${payment.id}`)\n                              }\n                              className=\"text-zinc-500 hover:text-white\"\n                            >\n                              {copied === `id-${payment.id}` ? (\n                                <Check className=\"w-4 h-4 text-cyan-400\" />\n                              ) : (\n                                <Copy className=\"w-4 h-4\" />\n                              )}\n                            </button>\n                          </div>\n                        </td>\n                        <td className=\"py-4\">\n                          <span className=\"text-zinc-300 font-mono text-sm\">\n                            {formatAddress(payment.customerWallet)}\n                          </span>\n                        </td>\n                        <td className=\"py-4\">\n                          <span className=\"font-semibold text-white\">\n                            ${payment.amount.toFixed(2)}\n                          </span>\n                          <span className=\"text-zinc-500 text-sm ml-1\">\n                            USDC\n                          </span>\n                        </td>\n                        <td className=\"py-4\">\n                          <span\n                            className={`px-2 py-1 rounded-full text-xs font-medium ${\n                              payment.status === \"completed\"\n                                ? \"bg-purple-500/20 text-cyan-400\"\n                                : payment.status === \"refunded\"\n                                ? \"bg-amber-500/20 text-amber-400\"\n                                : \"bg-zinc-500/20 text-zinc-400\"\n                            }`}\n                          >\n                            {payment.status}\n                          </span>\n                        </td>\n                        <td className=\"py-4 text-zinc-400 text-sm\">\n                          {formatDate(payment.completedAt)}\n                        </td>\n                        <td className=\"py-4\">\n                          <div className=\"flex items-center gap-2\">\n                            <a\n                              href={`https://explorer.solana.com/tx/${payment.txSignature}?cluster=devnet`}\n                              target=\"_blank\"\n                              rel=\"noopener noreferrer\"\n                              className=\"p-2 text-zinc-500 hover:text-white hover:bg-zinc-800 rounded-lg transition-colors\"\n                            >\n                              <ExternalLink className=\"w-4 h-4\" />\n                            </a>\n                          </div>\n                        </td>\n                      </motion.tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            )}\n          </motion.div>\n\n          {/* Integration Code Snippet */}\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ delay: 0.8 }}\n            className=\"mt-8 pop-card p-6\"\n          >\n            <div className=\"flex items-center justify-between mb-4\">\n              <h2 className=\"text-xl font-bold\">Quick Integration</h2>\n              <button\n                onClick={() =>\n                  copyToClipboard(\n                    `const session = await fetch('/api/checkout/sessions', {\n  method: 'POST',\n  body: JSON.stringify({\n    merchantId: 'your-store',\n    merchantWallet: '${publicKey || \"YOUR_WALLET\"}',\n    amount: 29.99,\n    successUrl: 'https://yoursite.com/success',\n    cancelUrl: 'https://yoursite.com/cancel'\n  })\n});\n// Redirect to session.url`,\n                    \"code\"\n                  )\n                }\n                className=\"flex items-center gap-2 text-sm text-zinc-400 hover:text-white\"\n              >\n                {copied === \"code\" ? (\n                  <>\n                    <Check className=\"w-4 h-4 text-cyan-400\" /> Copied!\n                  </>\n                ) : (\n                  <>\n                    <Copy className=\"w-4 h-4\" /> Copy code\n                  </>\n                )}\n              </button>\n            </div>\n            <pre className=\"bg-zinc-900 rounded-xl p-4 overflow-x-auto text-sm\">\n              <code>\n                <span className=\"text-purple-400\">const</span>{\" \"}\n                <span className=\"text-cyan-300\">session</span>{\" \"}\n                <span className=\"text-pink-400\">=</span>{\" \"}\n                <span className=\"text-purple-400\">await</span>{\" \"}\n                <span className=\"text-yellow-300\">fetch</span>\n                <span className=\"text-zinc-300\">(</span>\n                <span className=\"text-green-400\">\n                  &apos;/api/checkout/sessions&apos;\n                </span>\n                <span className=\"text-zinc-300\">, {\"{\"}</span>\n                {\"\\n\"}\n                {\"  \"}\n                <span className=\"text-cyan-300\">method</span>\n                <span className=\"text-zinc-300\">: </span>\n                <span className=\"text-green-400\">&apos;POST&apos;</span>\n                <span className=\"text-zinc-300\">,</span>\n                {\"\\n\"}\n                {\"  \"}\n                <span className=\"text-cyan-300\">body</span>\n                <span className=\"text-zinc-300\">: </span>\n                <span className=\"text-yellow-300\">JSON</span>\n                <span className=\"text-zinc-300\">.</span>\n                <span className=\"text-yellow-300\">stringify</span>\n                <span className=\"text-zinc-300\">({\"{\"}</span>\n                {\"\\n\"}\n                {\"    \"}\n                <span className=\"text-cyan-300\">merchantId</span>\n                <span className=\"text-zinc-300\">: </span>\n                <span className=\"text-green-400\">&apos;your-store&apos;</span>\n                <span className=\"text-zinc-300\">,</span>\n                {\"\\n\"}\n                {\"    \"}\n                <span className=\"text-cyan-300\">merchantWallet</span>\n                <span className=\"text-zinc-300\">: </span>\n                <span className=\"text-green-400\">\n                  &apos;{publicKey?.slice(0, 20) || \"YOUR_WALLET\"}...&apos;\n                </span>\n                <span className=\"text-zinc-300\">,</span>\n                {\"\\n\"}\n                {\"    \"}\n                <span className=\"text-cyan-300\">amount</span>\n                <span className=\"text-zinc-300\">: </span>\n                <span className=\"text-orange-400\">29.99</span>\n                <span className=\"text-zinc-300\">,</span>\n                {\"\\n\"}\n                {\"    \"}\n                <span className=\"text-cyan-300\">successUrl</span>\n                <span className=\"text-zinc-300\">: </span>\n                <span className=\"text-green-400\">\n                  &apos;https://yoursite.com/success&apos;\n                </span>\n                <span className=\"text-zinc-300\">,</span>\n                {\"\\n\"}\n                {\"    \"}\n                <span className=\"text-cyan-300\">cancelUrl</span>\n                <span className=\"text-zinc-300\">: </span>\n                <span className=\"text-green-400\">\n                  &apos;https://yoursite.com/cancel&apos;\n                </span>\n                {\"\\n\"}\n                {\"  \"}\n                <span className=\"text-zinc-300\">{\"}\"})</span>\n                {\"\\n\"}\n                <span className=\"text-zinc-300\">{\"}\"});</span>\n                {\"\\n\"}\n                <span className=\"text-zinc-500\">\n                  // Redirect customer to session.url\n                </span>\n              </code>\n            </pre>\n          </motion.div>\n        </div>\n      </div>\n      <Footer />\n    </>\n  );\n}\n"],"names":[],"mappings":"iDAEA,EAAA,CAAA,CAAA,OACA,EAAA,CAAA,CAAA,OACA,EAAA,CAAA,CAAA"}