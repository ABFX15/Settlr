{"version":3,"sources":["../../../../app/frontend/src/app/onboarding/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { motion } from \"framer-motion\";\nimport { usePrivy } from \"@privy-io/react-auth\";\nimport { useActiveWallet } from \"@/hooks/useActiveWallet\";\nimport {\n  Store,\n  Check,\n  Copy,\n  Wallet,\n  Building2,\n  Key,\n  ArrowRight,\n  Loader2,\n  LogIn,\n  AlertCircle,\n  ExternalLink,\n  Sparkles,\n} from \"lucide-react\";\nimport Link from \"next/link\";\n\ntype PayoutMethod = \"wallet\" | \"exchange\";\n\ninterface OnboardingState {\n  step: 1 | 2 | 3 | 4;\n  businessName: string;\n  websiteUrl: string;\n  payoutMethod: PayoutMethod;\n  payoutAddress: string;\n  webhookUrl: string;\n  merchantId: string | null;\n  apiKey: string | null;\n  error: string | null;\n}\n\nexport default function OnboardingPage() {\n  const { authenticated, login, ready } = usePrivy();\n  const { publicKey, connected } = useActiveWallet();\n\n  const [state, setState] = useState<OnboardingState>({\n    step: 1,\n    businessName: \"\",\n    websiteUrl: \"\",\n    payoutMethod: \"wallet\",\n    payoutAddress: \"\",\n    webhookUrl: \"\",\n    merchantId: null,\n    apiKey: null,\n    error: null,\n  });\n\n  const [loading, setLoading] = useState(false);\n  const [copied, setCopied] = useState<string | null>(null);\n\n  // Auto-fill wallet address if connected\n  useEffect(() => {\n    if (\n      connected &&\n      publicKey &&\n      state.payoutMethod === \"wallet\" &&\n      !state.payoutAddress\n    ) {\n      setState((s) => ({ ...s, payoutAddress: publicKey }));\n    }\n  }, [connected, publicKey, state.payoutMethod, state.payoutAddress]);\n\n  const copyToClipboard = (text: string, label: string) => {\n    navigator.clipboard.writeText(text);\n    setCopied(label);\n    setTimeout(() => setCopied(null), 2000);\n  };\n\n  const validateStep = (step: number): boolean => {\n    switch (step) {\n      case 1:\n        return state.businessName.trim().length >= 2;\n      case 2:\n        return isValidSolanaAddress(state.payoutAddress);\n      case 3:\n        return true; // Webhook is optional\n      default:\n        return false;\n    }\n  };\n\n  const isValidSolanaAddress = (address: string): boolean => {\n    return /^[1-9A-HJ-NP-Za-km-z]{32,44}$/.test(address);\n  };\n\n  const handleSubmit = async () => {\n    if (!validateStep(1) || !validateStep(2)) {\n      setState((s) => ({ ...s, error: \"Please fill in all required fields\" }));\n      return;\n    }\n\n    setLoading(true);\n    setState((s) => ({ ...s, error: null }));\n\n    try {\n      const response = await fetch(\"/api/merchants/register\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          name: state.businessName,\n          websiteUrl: state.websiteUrl || null,\n          walletAddress: state.payoutAddress,\n          webhookUrl: state.webhookUrl || null,\n        }),\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        throw new Error(data.error || \"Failed to register merchant\");\n      }\n\n      setState((s) => ({\n        ...s,\n        step: 4,\n        merchantId: data.merchant.id,\n        apiKey: data.apiKey,\n      }));\n    } catch (err) {\n      setState((s) => ({\n        ...s,\n        error: err instanceof Error ? err.message : \"Registration failed\",\n      }));\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Not authenticated\n  if (ready && !authenticated) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center p-4 bg-[#0a0a0f]\">\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"bg-zinc-900 border border-zinc-800 rounded-2xl p-8 text-center max-w-md\"\n        >\n          <div className=\"w-16 h-16 rounded-full bg-[#a855f7]/10 flex items-center justify-center mx-auto mb-6\">\n            <Store className=\"w-8 h-8 text-[#a855f7]\" />\n          </div>\n          <h2 className=\"text-2xl font-bold text-white mb-4\">\n            Become a Merchant\n          </h2>\n          <p className=\"text-zinc-400 mb-6\">\n            Sign in to set up non-custodial payments. Full control of your funds\n            â€” no middlemen.\n          </p>\n          <button\n            onClick={login}\n            className=\"inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-[#a855f7] to-[#22d3ee] text-white font-semibold rounded-xl hover:opacity-90 transition-opacity\"\n          >\n            <LogIn className=\"w-4 h-4\" />\n            Sign In to Continue\n          </button>\n        </motion.div>\n      </div>\n    );\n  }\n\n  // Loading\n  if (!ready) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-[#0a0a0f]\">\n        <Loader2 className=\"w-8 h-8 text-[#a855f7] animate-spin\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen py-12 px-4 pt-32 bg-[#0a0a0f]\">\n      <div className=\"max-w-2xl mx-auto\">\n        {/* Header */}\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"text-center mb-12\"\n        >\n          <div className=\"w-16 h-16 rounded-2xl bg-gradient-to-br from-[#a855f7] to-[#22d3ee] flex items-center justify-center mx-auto mb-6\">\n            <Store className=\"w-8 h-8 text-white\" />\n          </div>\n          <h1 className=\"text-4xl font-bold text-white mb-4\">\n            Merchant Onboarding\n          </h1>\n          <p className=\"text-zinc-400 text-lg max-w-xl mx-auto\">\n            Set up non-custodial payments. Funds settle directly to your wallet\n            â€” instant and secure.\n          </p>\n        </motion.div>\n\n        {/* Progress Steps */}\n        <div className=\"flex items-center justify-center mb-12\">\n          {[1, 2, 3, 4].map((step, i) => (\n            <div key={step} className=\"flex items-center\">\n              <div\n                className={`w-10 h-10 rounded-full flex items-center justify-center font-semibold transition-all ${\n                  state.step >= step\n                    ? \"bg-gradient-to-r from-[#a855f7] to-[#22d3ee] text-white\"\n                    : \"bg-zinc-800 text-zinc-500\"\n                }`}\n              >\n                {state.step > step ? <Check className=\"w-5 h-5\" /> : step}\n              </div>\n              {i < 3 && (\n                <div\n                  className={`w-16 h-1 mx-2 rounded ${\n                    state.step > step ? \"bg-[#22d3ee]\" : \"bg-zinc-800\"\n                  }`}\n                />\n              )}\n            </div>\n          ))}\n        </div>\n\n        {/* Error Message */}\n        {state.error && (\n          <motion.div\n            initial={{ opacity: 0, y: -10 }}\n            animate={{ opacity: 1, y: 0 }}\n            className=\"mb-6 p-4 bg-red-500/10 border border-red-500/30 rounded-xl flex items-center gap-3\"\n          >\n            <AlertCircle className=\"w-5 h-5 text-red-400\" />\n            <p className=\"text-red-400\">{state.error}</p>\n          </motion.div>\n        )}\n\n        {/* Step 1: Business Info */}\n        {state.step === 1 && (\n          <motion.div\n            initial={{ opacity: 0, x: 20 }}\n            animate={{ opacity: 1, x: 0 }}\n            className=\"bg-zinc-900 border border-zinc-800 rounded-2xl p-8\"\n          >\n            <div className=\"flex items-center gap-3 mb-6\">\n              <div className=\"w-10 h-10 rounded-xl bg-[#a855f7]/10 flex items-center justify-center\">\n                <Building2 className=\"w-5 h-5 text-[#a855f7]\" />\n              </div>\n              <div>\n                <h2 className=\"text-xl font-semibold text-white\">\n                  Business Information\n                </h2>\n                <p className=\"text-zinc-500 text-sm\">\n                  Tell us about your business\n                </p>\n              </div>\n            </div>\n\n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-zinc-300 mb-2\">\n                  Business Name *\n                </label>\n                <input\n                  type=\"text\"\n                  value={state.businessName}\n                  onChange={(e) =>\n                    setState((s) => ({ ...s, businessName: e.target.value }))\n                  }\n                  placeholder=\"Your Company Name\"\n                  className=\"w-full px-4 py-3 bg-zinc-800 border border-zinc-700 rounded-xl text-white placeholder-zinc-500 focus:outline-none focus:ring-2 focus:ring-[#a855f7]/50\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-zinc-300 mb-2\">\n                  Website URL\n                </label>\n                <input\n                  type=\"url\"\n                  value={state.websiteUrl}\n                  onChange={(e) =>\n                    setState((s) => ({ ...s, websiteUrl: e.target.value }))\n                  }\n                  placeholder=\"https://yourwebsite.com\"\n                  className=\"w-full px-4 py-3 bg-zinc-800 border border-zinc-700 rounded-xl text-white placeholder-zinc-500 focus:outline-none focus:ring-2 focus:ring-[#a855f7]/50\"\n                />\n                <p className=\"text-xs text-zinc-500 mt-1\">\n                  Optional â€” helps us verify your business\n                </p>\n              </div>\n            </div>\n\n            <div className=\"mt-8 flex justify-end\">\n              <button\n                onClick={() =>\n                  validateStep(1) && setState((s) => ({ ...s, step: 2 }))\n                }\n                disabled={!validateStep(1)}\n                className=\"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-[#a855f7] to-[#22d3ee] text-white font-semibold rounded-xl disabled:opacity-50 disabled:cursor-not-allowed hover:opacity-90 transition-opacity\"\n              >\n                Continue\n                <ArrowRight className=\"w-4 h-4\" />\n              </button>\n            </div>\n          </motion.div>\n        )}\n\n        {/* Step 2: Payout Settings */}\n        {state.step === 2 && (\n          <motion.div\n            initial={{ opacity: 0, x: 20 }}\n            animate={{ opacity: 1, x: 0 }}\n            className=\"bg-zinc-900 border border-zinc-800 rounded-2xl p-8\"\n          >\n            <div className=\"flex items-center gap-3 mb-6\">\n              <div className=\"w-10 h-10 rounded-xl bg-[#22d3ee]/10 flex items-center justify-center\">\n                <Wallet className=\"w-5 h-5 text-[#22d3ee]\" />\n              </div>\n              <div>\n                <h2 className=\"text-xl font-semibold text-white\">\n                  Payout Settings\n                </h2>\n                <p className=\"text-zinc-500 text-sm\">\n                  Where should we send your payments?\n                </p>\n              </div>\n            </div>\n\n            {/* Payout Method Selection */}\n            <div className=\"grid grid-cols-2 gap-4 mb-6\">\n              <button\n                onClick={() =>\n                  setState((s) => ({\n                    ...s,\n                    payoutMethod: \"wallet\",\n                    payoutAddress: publicKey || \"\",\n                  }))\n                }\n                className={`p-4 rounded-xl border-2 transition-all ${\n                  state.payoutMethod === \"wallet\"\n                    ? \"border-[#a855f7] bg-[#a855f7]/10\"\n                    : \"border-zinc-700 hover:border-zinc-600\"\n                }`}\n              >\n                <Wallet\n                  className={`w-6 h-6 mx-auto mb-2 ${\n                    state.payoutMethod === \"wallet\"\n                      ? \"text-[#a855f7]\"\n                      : \"text-zinc-400\"\n                  }`}\n                />\n                <p\n                  className={`font-medium ${\n                    state.payoutMethod === \"wallet\"\n                      ? \"text-white\"\n                      : \"text-zinc-400\"\n                  }`}\n                >\n                  Solana Wallet\n                </p>\n                <p className=\"text-xs text-zinc-500 mt-1\">\n                  Receive USDC directly\n                </p>\n              </button>\n\n              <button\n                onClick={() =>\n                  setState((s) => ({\n                    ...s,\n                    payoutMethod: \"exchange\",\n                    payoutAddress: \"\",\n                  }))\n                }\n                className={`p-4 rounded-xl border-2 transition-all ${\n                  state.payoutMethod === \"exchange\"\n                    ? \"border-[#22d3ee] bg-[#22d3ee]/10\"\n                    : \"border-zinc-700 hover:border-zinc-600\"\n                }`}\n              >\n                <Building2\n                  className={`w-6 h-6 mx-auto mb-2 ${\n                    state.payoutMethod === \"exchange\"\n                      ? \"text-[#22d3ee]\"\n                      : \"text-zinc-400\"\n                  }`}\n                />\n                <p\n                  className={`font-medium ${\n                    state.payoutMethod === \"exchange\"\n                      ? \"text-white\"\n                      : \"text-zinc-400\"\n                  }`}\n                >\n                  Exchange Address\n                </p>\n                <p className=\"text-xs text-zinc-500 mt-1\">\n                  Coinbase, Kraken, etc.\n                </p>\n              </button>\n            </div>\n\n            {/* Address Input */}\n            <div>\n              <label className=\"block text-sm font-medium text-zinc-300 mb-2\">\n                {state.payoutMethod === \"wallet\"\n                  ? \"Wallet Address *\"\n                  : \"Exchange Deposit Address *\"}\n              </label>\n              <div className=\"relative\">\n                <input\n                  type=\"text\"\n                  value={state.payoutAddress}\n                  onChange={(e) =>\n                    setState((s) => ({ ...s, payoutAddress: e.target.value }))\n                  }\n                  placeholder={\n                    state.payoutMethod === \"wallet\"\n                      ? \"Your Solana wallet address\"\n                      : \"Your Coinbase/Kraken USDC deposit address\"\n                  }\n                  className=\"w-full px-4 py-3 bg-zinc-800 border border-zinc-700 rounded-xl text-white placeholder-zinc-500 focus:outline-none focus:ring-2 focus:ring-[#22d3ee]/50 font-mono text-sm\"\n                />\n                {connected && state.payoutMethod === \"wallet\" && (\n                  <button\n                    onClick={() =>\n                      publicKey &&\n                      setState((s) => ({ ...s, payoutAddress: publicKey }))\n                    }\n                    className=\"absolute right-3 top-1/2 -translate-y-1/2 text-xs text-[#22d3ee] hover:text-white transition-colors\"\n                  >\n                    Use connected wallet\n                  </button>\n                )}\n              </div>\n              {state.payoutAddress &&\n                !isValidSolanaAddress(state.payoutAddress) && (\n                  <p className=\"text-red-400 text-sm mt-2\">\n                    Invalid Solana address\n                  </p>\n                )}\n              {state.payoutMethod === \"exchange\" && (\n                <p className=\"text-zinc-500 text-xs mt-2\">\n                  ðŸ’¡ Tip: Use your exchange&apos;s Solana USDC deposit address.\n                  Funds will auto-convert if your exchange supports it.\n                </p>\n              )}\n            </div>\n\n            <div className=\"mt-8 flex justify-between\">\n              <button\n                onClick={() => setState((s) => ({ ...s, step: 1 }))}\n                className=\"px-6 py-3 text-zinc-400 hover:text-white transition-colors\"\n              >\n                Back\n              </button>\n              <button\n                onClick={() =>\n                  validateStep(2) && setState((s) => ({ ...s, step: 3 }))\n                }\n                disabled={!validateStep(2)}\n                className=\"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-[#a855f7] to-[#22d3ee] text-white font-semibold rounded-xl disabled:opacity-50 disabled:cursor-not-allowed hover:opacity-90 transition-opacity\"\n              >\n                Continue\n                <ArrowRight className=\"w-4 h-4\" />\n              </button>\n            </div>\n          </motion.div>\n        )}\n\n        {/* Step 3: Webhook (Optional) */}\n        {state.step === 3 && (\n          <motion.div\n            initial={{ opacity: 0, x: 20 }}\n            animate={{ opacity: 1, x: 0 }}\n            className=\"bg-zinc-900 border border-zinc-800 rounded-2xl p-8\"\n          >\n            <div className=\"flex items-center gap-3 mb-6\">\n              <div className=\"w-10 h-10 rounded-xl bg-purple-500/10 flex items-center justify-center\">\n                <Key className=\"w-5 h-5 text-purple-400\" />\n              </div>\n              <div>\n                <h2 className=\"text-xl font-semibold text-white\">\n                  Webhook URL\n                </h2>\n                <p className=\"text-zinc-500 text-sm\">\n                  Optional: Get notified of payments\n                </p>\n              </div>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-zinc-300 mb-2\">\n                Webhook Endpoint (Optional)\n              </label>\n              <input\n                type=\"url\"\n                value={state.webhookUrl}\n                onChange={(e) =>\n                  setState((s) => ({ ...s, webhookUrl: e.target.value }))\n                }\n                placeholder=\"https://yoursite.com/api/webhooks/settlr\"\n                className=\"w-full px-4 py-3 bg-zinc-800 border border-zinc-700 rounded-xl text-white placeholder-zinc-500 focus:outline-none focus:ring-2 focus:ring-purple-500/50\"\n              />\n              <p className=\"text-zinc-500 text-xs mt-2\">\n                We&apos;ll POST payment events to this URL. You can configure\n                this later in your dashboard.\n              </p>\n            </div>\n\n            <div className=\"mt-8 flex justify-between\">\n              <button\n                onClick={() => setState((s) => ({ ...s, step: 2 }))}\n                className=\"px-6 py-3 text-zinc-400 hover:text-white transition-colors\"\n              >\n                Back\n              </button>\n              <button\n                onClick={handleSubmit}\n                disabled={loading}\n                className=\"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-[#a855f7] to-[#22d3ee] text-white font-semibold rounded-xl disabled:opacity-50 hover:opacity-90 transition-opacity\"\n              >\n                {loading ? (\n                  <>\n                    <Loader2 className=\"w-4 h-4 animate-spin\" />\n                    Creating Account...\n                  </>\n                ) : (\n                  <>\n                    <Sparkles className=\"w-4 h-4\" />\n                    Complete Setup\n                  </>\n                )}\n              </button>\n            </div>\n          </motion.div>\n        )}\n\n        {/* Step 4: Success */}\n        {state.step === 4 && (\n          <motion.div\n            initial={{ opacity: 0, scale: 0.95 }}\n            animate={{ opacity: 1, scale: 1 }}\n            className=\"bg-zinc-900 border border-zinc-800 rounded-2xl p-8\"\n          >\n            <div className=\"text-center mb-8\">\n              <div className=\"w-20 h-20 rounded-full bg-gradient-to-r from-[#a855f7] to-[#22d3ee] flex items-center justify-center mx-auto mb-6\">\n                <Check className=\"w-10 h-10 text-white\" />\n              </div>\n              <h2 className=\"text-2xl font-bold text-white mb-2\">\n                You&apos;re All Set! ðŸŽ‰\n              </h2>\n              <p className=\"text-zinc-400\">\n                Your merchant account has been created. Save your API key below.\n              </p>\n            </div>\n\n            {/* API Key */}\n            <div className=\"bg-zinc-800 rounded-xl p-6 mb-6\">\n              <div className=\"flex items-center justify-between mb-2\">\n                <span className=\"text-sm font-medium text-zinc-300\">\n                  Your API Key\n                </span>\n                <span className=\"text-xs text-amber-400 bg-amber-400/10 px-2 py-1 rounded\">\n                  Save this now - shown only once\n                </span>\n              </div>\n              <div className=\"flex items-center gap-3\">\n                <code className=\"flex-1 p-3 bg-zinc-900 rounded-lg text-[#22d3ee] font-mono text-sm break-all\">\n                  {state.apiKey}\n                </code>\n                <button\n                  onClick={() =>\n                    state.apiKey && copyToClipboard(state.apiKey, \"apiKey\")\n                  }\n                  className=\"p-3 bg-zinc-700 rounded-lg hover:bg-zinc-600 transition-colors\"\n                >\n                  {copied === \"apiKey\" ? (\n                    <Check className=\"w-5 h-5 text-emerald-400\" />\n                  ) : (\n                    <Copy className=\"w-5 h-5 text-zinc-300\" />\n                  )}\n                </button>\n              </div>\n            </div>\n\n            {/* Quick Start Code */}\n            <div className=\"bg-zinc-800 rounded-xl p-6 mb-6\">\n              <h3 className=\"text-sm font-medium text-zinc-300 mb-3\">\n                Quick Start\n              </h3>\n              <pre className=\"bg-zinc-900 rounded-lg p-4 text-sm overflow-x-auto\">\n                <code className=\"text-zinc-300\">\n                  {`npm install @settlr/sdk\n\nimport { Settlr } from '@settlr/sdk';\n\nconst settlr = new Settlr({\n  apiKey: '${state.apiKey?.slice(0, 12)}...',\n  merchant: {\n    name: '${state.businessName}',\n  }\n});\n\n// Create a payment\nconst payment = await settlr.createPayment({\n  amount: 29.99,\n  successUrl: 'https://yoursite.com/success',\n});\n\n// Redirect to checkout\nwindow.location.href = payment.checkoutUrl;`}\n                </code>\n              </pre>\n            </div>\n\n            {/* Next Steps */}\n            <div className=\"grid grid-cols-2 gap-4\">\n              <Link\n                href=\"/dashboard\"\n                className=\"flex items-center justify-center gap-2 p-4 bg-zinc-800 rounded-xl hover:bg-zinc-700 transition-colors\"\n              >\n                <Store className=\"w-5 h-5 text-[#a855f7]\" />\n                <span className=\"text-white font-medium\">Go to Dashboard</span>\n              </Link>\n              <Link\n                href=\"/docs\"\n                className=\"flex items-center justify-center gap-2 p-4 bg-zinc-800 rounded-xl hover:bg-zinc-700 transition-colors\"\n              >\n                <ExternalLink className=\"w-5 h-5 text-[#22d3ee]\" />\n                <span className=\"text-white font-medium\">View Docs</span>\n              </Link>\n            </div>\n          </motion.div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"iDAEA,EAAA,CAAA,CAAA,OACA,EAAA,CAAA,CAAA,OACA,EAAA,CAAA,CAAA"}